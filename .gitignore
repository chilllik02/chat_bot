import gspread
from oauth2client.service_account import ServiceAccountCredentials
import telebot



def create_keyfile_dict():
    variables_keys = {
        "type": "service_account",
        "project_id": "botnails-416411",
        "private_key_id": "29c5fb98de0e2c80c1abc22211d1e5643a1f9389",
        "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC0pfMoTFvYr4Ti\n"
                       "ECLAcTFK0E9Ggb+dEQoAU7LpOX6oVvj2QsCP2G1T4p+gxtccRF/aT7RiwTYfnl5X\n8tzCzoHH2Lekqm6IxuwgrycIomVS5"
                       "T3dSnq3bPkcwPIwNcB28E/gGEPhIljJUvpp\nCmLlOXc4KS/WZUhh4M1LVNCxxUyprrEkgj3Q6IkCS6+XaNxvl6mqUJj7Mg"
                       "nUBZI6\nPeT914OchW3LIVZvrYvxK725qRU0qHuqWKrzQRkJvsJuzdSlYEOg5T+DBic+ObvY\nJ2GK57463o12TnoahS0s5"
                       "BmzIl412gIQKMr2HCLNQjp31KBJovPVE+a82crDgAfD\nio3Xi/YtAgMBAAECggEAAapo0wT9vIc024MeN4cqon6ND9va3v"
                       "uZUH7+61hfAsfW\nnlfnr2bvfp354vnalkSs3x8Wm/boxfNZVhCSg43wKCZR5M6Di3oIOpKP/8FUtFq8\n0QKJIVbD0Ac2s"
                       "tNA+k+RtZcU6v4E04IWSG/D86zEqfQ8ZRFmKVRdYxluQkO5Rto2\nox6GDycK+mUN1ZGu5g+bB7k2DpK05bpiIP47MDphXz"
                       "qy/WnXvJshCKlg0K+oEBN2\nlN4FaVw7eHHXCjEryIWEh1oI0TGt7BFoVM08PEBkC4ScGsAJgVdgwozuKeBaTSAQ\n3n9+3"
                       "hZdRGPbgYIu47Y9SB1NLKUjVteTR/ISvmJL3QKBgQDgVNz5vp3MynQOiGMo\n9cIhTHleuO9T9YLPqUwtEgLLDnc5oPAmZh"
                       "KniQ+bH2Zh+yok7VOxMWgb6Lu80WL6\nPlsYqAddIaampQ7ugNDL6/3fhueEaoNf2P+WWIiNA4N+e0sWXOpGvXjMaeV3kJt"
                       "L\nRTFD4G9yyAK8LbBSfGhaf3FlOwKBgQDOJmnWOW4lfMCOwHj2RSSeGsJo9jw+TfZN\nKoqkVjqFctYMfXtWbnpnDbMIV4"
                       "9B/HYpweFkFQhVsA+Rxd4So2MCvOfDUGxhMVq7\nlwDO44dAsKrzSawUS4K408sqNgtcJ0SnuMgfKHaNepldWzHoQC1wpnp"
                       "CcgTqNCjn\nSTtp/vg7twKBgAMrb8vfk583JRineK81eb66s+RQvKD1ERoaDEd+v6da1vhre7kv\nLAhN+Xh5oxqzT88hw1"
                       "L3nb73NN/gHYPnqaXZifEY7p/gKSvZihm3hejIoTDPyHds\nO4BGU/eaGxuIZnE0cuL4/mH1BRcBZhBUM/P/kdOPW+qIwrs"
                       "HovnUXyfNAoGAGJhW\nqjth29EdfCqUg/VN4BsbNMCkAV710tEPh3nOM5u20/ionXBC5EarJISlz96aDnNW\nO8WSn/6IbQ"
                       "DpdNnPd0UodZIDzDjCNX1XmFdnDJ3HV41jnWxA5WJHa/rUsiLxOv19\nytHeCxUkdRHrS2VUxormLUVDNtoQQz/mecf0v9M"
                       "CgYEAzTZtbCLMk7GIGkaGDrOt\n3RbttD6V0Jbs75UPfeMFS2/wMgZFI/by4jGcunf06sUr9WiaKsvlutk+/zIu7M1C\nYn"
                       "sGwwzWkqoNTQZVTh+0BKloNlS0sW40R+wpVPvVXEBndboC2opdBTrCHCcLDZjb\nlY7bAXS08kHoCIeUnqiSriw=\n--"
                       "---END PRIVATE KEY-----\n",
        "client_email": "nailsbot-567@botnails-416411.iam.gserviceaccount.com",
        "client_id": "113445500446136125190",
        "auth_uri": "https://accounts.google.com/o/oauth2/auth",
        "token_uri": "https://oauth2.googleapis.com/token",
        "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
        "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/nailsbot-567%40botnails-416411.iam.g"
                                "serviceaccount.com",
        "universe_domain": "googleapis.com"
    }
    return variables_keys


# –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Google –¢–∞–±–ª–∏—Ü–∞–º
scope = ['https://spreadsheets.google.com/feeds',
         'https://www.googleapis.com/auth/drive']
creds = ServiceAccountCredentials.from_json_keyfile_dict(create_keyfile_dict(), scope)
client = gspread.authorize(creds)

# –û—Ç–∫—Ä—ã–≤–∞–µ–º Google –¢–∞–±–ª–∏—Ü—É
spreadsheet = client.open('Nailsbot')
worksheet = spreadsheet.sheet1

bot = telebot.TeleBot('7028121053:AAG-SMb4hWueFCUafij1ZPvI22gmK64iY6Q')
bot.set_webhook()


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def start(message):
    bot.reply_to(message,
                 "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–∑–∞–ø–∏—Å—å –Ω–∞ –æ–Ω–ª–∞–π–Ω –≤–∏–¥–µ–æ—É—Ä–æ–∫, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ"
                 "—Ñ–æ–Ω–∞.")


# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True)
def handle_message(message):
    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    name = message.from_user.first_name
    phone = message.text

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ
    records = worksheet.get_all_records()
    for record in records:
        if record['–ù–∏–∫–Ω–µ–π–º –≤ —Ç–≥'] == name and record['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'] == phone:
            bot.reply_to(message, "–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –æ–Ω–ª–∞–π–Ω –ø–æ –º–∞–Ω–∏–∫—é—Ä—É.")
            return
        

    # –ï—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –µ—â–µ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É
    new_record = [name, phone]
    worksheet.append_row(new_record)
    bot.reply_to(message, '–ü—Ä–∏–≤–µ—Ç!–ù–∞ —Å–≤—è–∑–∏ –±–æ—Ç –í–∞—Å–∏–ª—å–µ–≤–æ–π –ï–ª–∏–∑–∞–≤–µ—Ç—ã @elizaveta.nails_30 –Ω–µ –±—É–¥—É —Å–ø–∞–º–∏—Ç—å!'

'–ü–æ–∑–¥—Ä–∞–≤–ª—è—é –í–∞—Å —Å –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º –ª–∏—Å—Ç –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏  –Ω–∞ –æ–Ω–ª–∞–π–Ω –≤–∏–¥–µ–æ-—É—Ä–æ–∫ ¬´–ö–û–†–†–ï–ö–¶–ò–Ø –¢–û–õ–¨–ö–û –ì–ï–õ–ï–ú¬ª,–≤ –∫–æ—Ç–æ—Ä–æ–º —è –Ω–∞—É—á—É –≤–∞—Å –∞–≤—Ç–æ—Ä—Å–∫–æ–π —Ç–µ—Ö–Ω–∏–∫–µ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º–∞–Ω–∏–∫—é—Ä–∞,—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º –≥–µ–ª–µ–º.'

'–î–ª—è —Ç–µ—Ö –∫—Ç–æ –≤ –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ä–∞–Ω–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤–∏–¥–µ–æ-—É—Ä–æ–∫–∞,–ø–æ —Å–∞–º—ã–º –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º!'

'–í–∞–º –Ω—É–∂–Ω–æ –≤—Å–µ–≥–æ –ª–∏—à—å –∂–¥–∞—Ç—å –æ—Ç –º–µ–Ω—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–¥–∞–∂!üî•'

'–î–æ –≤—Å—Ç—Ä–µ—á–∏!')

# –ó–∞–ø—É—Å–∫–∞–µ–º —á–∞—Ç-–±–æ—Ç–∞

bot.polling()
