import gspread
from oauth2client.service_account import ServiceAccountCredentials
import telebot



def create_keyfile_dict():
    variables_keys = {
        "type": "you",
        "project_id": "you",
        "private_key_id": "you",
        "private_key": "-----BEGIN PRIVATE KEY-----\you
                       "---END PRIVATE KEY-----\n",
        "client_email": "you",
        "client_id": "you"
        "auth_uri": "you",
        "token_uri": "you",
        "auth_provider_x509_cert_url": "you",
        "client_x509_cert_url": "you"
                                "you",
        "universe_domain": "you"
    }
    return variables_keys


# –£–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Google –¢–∞–±–ª–∏—Ü–∞–º
scope = ['https://spreadsheets.google.com/feeds',
         'https://www.googleapis.com/auth/drive']
creds = ServiceAccountCredentials.from_json_keyfile_dict(create_keyfile_dict(), scope)
client = gspread.authorize(creds)

# –û—Ç–∫—Ä—ã–≤–∞–µ–º Google –¢–∞–±–ª–∏—Ü—É
spreadsheet = client.open('You sheets')
worksheet = spreadsheet.sheet1

bot = telebot.TeleBot('you tokin')
bot.set_webhook()


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def start(message):
    bot.reply_to(message,
                 "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–∑–∞–ø–∏—Å—å –Ω–∞ –æ–Ω–ª–∞–π–Ω –≤–∏–¥–µ–æ—É—Ä–æ–∫, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ"
                 "—Ñ–æ–Ω–∞.")


# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True)
def handle_message(message):
    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    name = message.from_user.first_name
    phone = message.text

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ
    records = worksheet.get_all_records()
    for record in records:
        if record['–ù–∏–∫–Ω–µ–π–º –≤ —Ç–≥'] == name and record['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'] == phone:
            bot.reply_to(message, "–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –æ–Ω–ª–∞–π–Ω –ø–æ –º–∞–Ω–∏–∫—é—Ä—É.")
            return
        

    # –ï—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –µ—â–µ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É
    new_record = [name, phone]
    worksheet.append_row(new_record)
    bot.reply_to(message, '–ü—Ä–∏–≤–µ—Ç!–ù–∞ —Å–≤—è–∑–∏ –±–æ—Ç –í–∞—Å–∏–ª—å–µ–≤–æ–π –ï–ª–∏–∑–∞–≤–µ—Ç—ã @elizaveta.nails_30 –Ω–µ –±—É–¥—É —Å–ø–∞–º–∏—Ç—å!'

'–ü–æ–∑–¥—Ä–∞–≤–ª—è—é –í–∞—Å —Å –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º –ª–∏—Å—Ç –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏  –Ω–∞ –æ–Ω–ª–∞–π–Ω –≤–∏–¥–µ–æ-—É—Ä–æ–∫ ¬´–ö–û–†–†–ï–ö–¶–ò–Ø –¢–û–õ–¨–ö–û –ì–ï–õ–ï–ú¬ª,–≤ –∫–æ—Ç–æ—Ä–æ–º —è –Ω–∞—É—á—É –≤–∞—Å –∞–≤—Ç–æ—Ä—Å–∫–æ–π —Ç–µ—Ö–Ω–∏–∫–µ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –º–∞–Ω–∏–∫—é—Ä–∞,—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º –≥–µ–ª–µ–º.'

'–î–ª—è —Ç–µ—Ö –∫—Ç–æ –≤ –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ä–∞–Ω–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤–∏–¥–µ–æ-—É—Ä–æ–∫–∞,–ø–æ —Å–∞–º—ã–º –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º!'

'–í–∞–º –Ω—É–∂–Ω–æ –≤—Å–µ–≥–æ –ª–∏—à—å –∂–¥–∞—Ç—å –æ—Ç –º–µ–Ω—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–¥–∞–∂!üî•'

'–î–æ –≤—Å—Ç—Ä–µ—á–∏!')

# –ó–∞–ø—É—Å–∫–∞–µ–º —á–∞—Ç-–±–æ—Ç–∞

bot.polling()
